### 体重トラッカー Webアプリ 要件定義書 v1.0（2025-07-03）

---

## 1. 概要

毎日記録しているスプレッドシートを Streamlit＋SQLite に置き換え、**個人 PC 内で完結**する軽量 Web アプリケーションを開発する。ブラウザ上のフォームから数値を入力するだけで、折れ線グラフと統計情報がリアルタイムに更新される機能を提供する。外部公開や認証機能は当面スコープ外とし、まずは MVD（Minimum Viable Dashboard）の完成を目標とする。

---

## 2. 目的

* **手入力の手間削減**：期間選択に応じたグラフ範囲の変更作業を自動化する。
* **視覚的フィードバック**：当日の数値と７日移動平均を重ねることで推移を一目で把握可能にする。
* **自己管理の継続**：シンプルで軽快な UI により、毎日の記録習慣の継続を支援する。

---

## 3. スコープ

### 3-1 機能要件（MVP）

| ID   | 機能                  | 詳細                                | 優先度 |
| ---- | ------------------- | --------------------------------- | --- |
| F-01 | **入力フォーム**          | 日付（デフォルト＝今日）、体重(kg)必須、体脂肪率(%)任意   | ★★★ |
| F-02 | **グラフ描画**           | 折れ線＋マーカー、７日移動平均を重ね描き              | ★★★ |
| F-03 | **期間フィルタ**          | 7 日／30 日／90 日／全期間をラジオボタン切り替え      | ★★★ |
| F-04 | **データ編集・削除**        | `st.data_editor` でインライン編集／行削除     | ★★★ |
| F-05 | **SQLite 永続化**      | 単一ファイル `data.db` に保存。起動時に自動スキーマ生成 | ★★★ |
| F-06 | **目標体重入力**          | サイドバーの小さなフォーム。設定すると進捗バーを表示        | ★★☆ |
| F-07 | **統計カード**           | 直近 7/30 日平均、最大・最小、差分              | ★★☆ |
| F-08 | **CSVインポート／エクスポート** | ボタンで全レコードを DL／アップロードで一括取込         | ★★☆ |

### 3-2 データバリデーション要件

| ID   | 要件                | 詳細                                |
| ---- | ----------------- | --------------------------------- |
| V-01 | 体重入力値の範囲チェック    | 10kg ≤ 体重 ≤ 300kg                 |
| V-02 | 体脂肪率入力値の範囲チェック  | 0% ≤ 体脂肪率 ≤ 100%                |
| V-03 | 日付の妥当性チェック      | 未来日付の入力制限、重複日付の処理方針          |
| V-04 | 必須項目チェック        | 体重未入力時のエラーメッセージ表示             |

### 3-3 エラーハンドリング要件

| 分類           | 要件                                    |
| ------------ | ------------------------------------- |
| データベースエラー    | 接続失敗時の代替処理、復旧手順の提示                    |
| ファイルI/Oエラー   | CSVファイル読み込み失敗時の処理                    |
| 画面表示エラー      | グラフ描画失敗時の代替表示                         |
| ユーザー入力エラー    | 不正値入力時の分かりやすいエラーメッセージ                 |

### 3-4 UI/UX要件

| 項目          | 要件                                |
| ----------- | --------------------------------- |
| レスポンシブデザイン  | 最小幅320px（スマートフォン）で表示崩れしないこと     |
| 操作性         | 主要操作（データ入力）は3クリック以内で完了すること      |
| フィードバック     | データ保存成功時に明確な成功メッセージを表示すること      |
| 読み込み時間      | 初期画面表示は2秒以内に完了すること              |

### 3-5 ブラウザ対応要件

| ブラウザ     | バージョン    | 対応状況 |
| -------- | -------- | ---- |
| Chrome   | 100以降    | ◎    |
| Firefox  | 100以降    | ◎    |
| Safari   | 15以降     | ○    |
| Edge     | 100以降    | ○    |

### 3-6 スコープ外

* Google OAuth など外部認証
* マルチユーザ／同期機能
* プッシュ通知・ダークモード等の装飾機能

---

## 4. 非機能要件

| 分類     | 要件                                              |
| ------ | ----------------------------------------------- |
| 性能     | 1レコード追加後0.5秒以内に画面再描画が完了すること                     |
| 可搬性    | Windows/macOS で `streamlit run main.py` のみで起動可能であること |
| セキュリティ | ローカル運用前提。DBファイルはOS標準のユーザ権限により保護               |
| 保守性    | ソースコードは1ページ＋DBヘルパー構成。初期化は自動スキーマ実行により完結         |

### 4-2 保存期間要件

| 項目     | 要件                        |
| ------ | ------------------------- |
| 保存期間   | 無期限（ユーザーの手動削除まで保持）        |
| 最大レコード数| 制限なし（実用上10年分≈3650レコード想定） |

### 4-3 セットアップ・運用要件

| 項目       | 要件                                        |
| -------- | ----------------------------------------- |
| 初回セットアップ | README.mdに従い5分以内でセットアップ完了すること            |
| 依存関係管理   | requirements.txtによる一括インストール対応             |
| データ移行    | 既存スプレッドシートからのデータインポート手順を提供すること          |

---

## 5. データモデル

```sql
measurements (
  id        INTEGER PRIMARY KEY AUTOINCREMENT,
  date      TEXT NOT NULL,      -- YYYY-MM-DD形式
  weight    REAL NOT NULL,      -- 体重（kg）
  body_fat  REAL                -- 体脂肪率（%）
)

settings (
  key   TEXT PRIMARY KEY,
  value REAL                   -- 目標体重等の設定値
)
```

---

## 6. 画面とフロー

1. **起動直後**

   * 30日間表示で空グラフまたはサンプルテキストを表示する。
2. **入力フォームでの登録**

   * データベースに `INSERT` 実行後、`st.experimental_rerun()` によりグラフを即座に更新する。
3. **期間ラジオボタンの選択**

   * セッション状態に値を保持し、DataFrame を期間でスライスして描画する。
4. **データの編集・削除**

   * `data_editor` の保存イベントにより `UPDATE/DELETE` を実行する。
5. **CSV操作**

   * ダウンロード：`to_csv` から `st.download_button` で提供。
   * アップロード：`file_uploader` でDataFrame結合後、重複チェックを経てバルク `INSERT` を実行。

---

## 7. 技術スタック & 構成

```
┌──────── Browser ───────┐
│ Streamlit front (main) │
└──────────┬────────────┘
           │ SQLite3 (sqlite3/Pandas)
           └── data.db  (ローカルファイル)
```

* Python 3.10+ / Streamlit 1.35 / Pandas / Plotly（または st.line\_chart）
* 依存関係は `requirements.txt` にまとめ、`venv` により環境を隔離する。

---

## 8. 開発ロードマップ（目安）

| フェーズ  | 期間        | 内容                            |
| ----- | --------- | ----------------------------- |
| 1     | 0.5 日     | DB ラッパ & スキーマ自動生成             |
| 2     | 1 日       | 入力フォーム＋`INSERT` 実装            |
| 3     | 0.5 日     | データバリデーション＋エラーハンドリング実装       |
| 4     | 0.5 日     | 折れ線グラフ＋移動平均                 |
| 5     | 0.5 日     | 期間フィルタ切替                    |
| 6     | 0.5 日     | `data_editor` CRUD 連携         |
| 7     | 0.5 日     | 目標体重フォーム＆進捗バー               |
| 8     | 0.5 日     | 統計カード／CSV I/O               |
| 9     | 0.5 日     | UI/UX改善・レスポンシブ対応            |
| **計** | **\~5 日** | β版完成                        |

---

## 9. リスクと対応

| リスク         | 対策                                    |
| ----------- | ------------------------------------- |
| DBロック／破損    | 書き込みは1スレッドに制限。自動バックアップを週1回で生成          |
| モバイル表示の崩れ   | `st.columns()` の幅を最小値指定および行ラップにより対応   |
| CSV重複データ    | `date` 一意制約チェックおよび上書き確認ダイアログにより対応    |

---

## 10. 将来拡張要件（Nice to Have）

| 項目        | 概要                      | 優先度 |
| --------- | ----------------------- | --- |
| BMI計算・表示  | 身長設定によるBMI自動計算・グラフ表示    | ★☆☆ |
| 目標達成通知    | 目標体重達成時の祝福メッセージ表示       | ★☆☆ |
| データ分析機能   | 月次・年次の統計サマリー表示          | ★☆☆ |
| テーマ設定     | ダークモード・ライトモード切り替え       | ★☆☆ |


